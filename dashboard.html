<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gemini Ambiental Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
        }

        /* Sidebar */
.sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: 
                        url('docs/assets/img/BackgroundMenu.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text h2 {
            font-size: 1.2em;
            margin-bottom: 0.2rem;
        }

        .logo-text p {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.5rem 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .nav-icon {
            font-size: 1.2em;
            width: 24px;
            text-align: center;
        }

        .logout-section {
            position: absolute;
            bottom: 2rem;
            left: 1rem;
            right: 1rem;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.3);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            color: #2c5f41;
            font-size: 2.5em;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #718096;
            font-size: 1.1em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4a8b64, #2c5f41);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
        }

        .user-details h3 {
            color: #2c5f41;
        }

        .user-details p {
            color: #718096;
            font-size: 0.9em;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .stat-card.primary {
            --accent-color: #4a8b64;
        }

        .stat-card.warning {
            --accent-color: #f6ad55;
        }

        .stat-card.success {
            --accent-color: #48bb78;
        }

        .stat-card.info {
            --accent-color: #4299e1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
        }

        .stat-icon.primary {
            background: linear-gradient(135deg, #4a8b64, #2c5f41);
        }

        .stat-icon.warning {
            background: linear-gradient(135deg, #f6ad55, #ed8936);
        }

        .stat-icon.success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .stat-icon.info {
            background: linear-gradient(135deg, #4299e1, #3182ce);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 1.1em;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            font-size: 0.9em;
            font-weight: 600;
        }

        .stat-change.positive {
            color: #48bb78;
        }

        .stat-change.negative {
            color: #f56565;
        }

        /* Dashboard Content Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c5f41;
        }

        .card-action {
            color: #4299e1;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .card-action:hover {
            background: rgba(66, 153, 225, 0.1);
        }

        /* Recent Activities */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: white;
            flex-shrink: 0;
        }

        .activity-icon.service {
            background: linear-gradient(135deg, #4a8b64, #2c5f41);
        }

        .activity-icon.quote {
            background: linear-gradient(135deg, #f6ad55, #ed8936);
        }

        .activity-icon.payment {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.2rem;
        }

        .activity-meta {
            color: #718096;
            font-size: 0.9em;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .quick-action {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 12px;
            text-decoration: none;
            color: #2d3748;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            background: white;
            border-color: #4a8b64;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .quick-action-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #4a8b64;
            color: white;
        }

        /* Calendar Widget */
        .calendar-widget {
            margin-bottom: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .calendar-day.today {
            background: #4a8b64;
            color: white;
        }

        .calendar-day.has-service {
            background: #fed7d7;
            color: #c53030;
        }

        .calendar-day:hover {
            background: #e6fffa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
               <div class="logo">
                <img src="LogoMenu.png" alt="Gemini Ambiental" style="height: 60px; object-fit: contain;">
            </div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item">
                <a href="dashboard.html" class="nav-link active">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="inventario.html" class="nav-link">
                    <span class="nav-icon">üì¶</span>
                    <span>Inventario</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="agenda.html" class="nav-link">
                    <span class="nav-icon">üìÖ</span>
                    <span>Agenda</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="personal.html" class="nav-link">
                    <span class="nav-icon">üë•</span>
                    <span>Personas</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="cotizaciones.html" class="nav-link">
                    <span class="nav-icon">üí∞</span>
                    <span>Cotizaciones</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="facturas.html" class="nav-link">
                    <span class="nav-icon">üìÑ</span>
                    <span>Facturas</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="servicios.html" class="nav-link">
                    <span class="nav-icon">üîß</span>
                    <span>Servicios</span>
                </a>
            </div>
        </nav>

        <div class="logout-section">
            <a href="index.html" class="logout-btn">
                <span class="nav-icon">üö™</span>
                <span>Cerrar Sesi√≥n</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <h1>Dashboard</h1>
                <p>Resumen general de Gemini Ambiental S.A.S</p>
            </div>
            <div class="user-info">
                <div class="user-avatar">GA</div>
                <div class="user-details">
                    <h3>Administrador</h3>
                    <p>Gemini Ambiental</p>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-header">
                    <div class="stat-icon primary">üë•</div>
                </div>
                <div class="stat-number">0</div>
                <div class="stat-label">Personas Activos</div>
                <div class="stat-change positive"></div>
            </div>

            <div class="stat-card warning">
                <div class="stat-header">
                    <div class="stat-icon warning">üìã</div>
                </div>
                <div class="stat-number">0</div>
                <div class="stat-label">Servicios Pendientes</div>
                <div class="stat-change positive"></div>
            </div>

            <div class="stat-card success">
                <div class="stat-header">
                    <div class="stat-icon success">üí∞</div>
                </div>
                <div class="stat-number">0</div>
                <div class="stat-label">Facturaci√≥n Mensual</div>
                <div class="stat-change positive"></div>
            </div>

            <div class="stat-card info">
                <div class="stat-header">
                    <div class="stat-icon info">üì¶</div>
                </div>
                <div class="stat-number">0</div>
                <div class="stat-label">Productos en Stock</div>
                <div class="stat-change negative"></div>
            </div>
        </div>

        <!-- Dashboard Content Grid -->
        <div class="dashboard-grid">
            <!-- Recent Activities -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Actividades Recientes</h2>
                    <a href="#" class="card-action">Ver todas</a>
                </div>

                <div class="activity-item">
                    <div class="activity-icon service">üêõ</div>
                    <div class="activity-content">
                        <div class="activity-title">Control de plagas - Restaurante El Buen Sabor</div>
                        <div class="activity-meta">Completado por Juan P√©rez ‚Ä¢ Hace 2 horas</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon quote">üí∞</div>
                    <div class="activity-content">
                        <div class="activity-title">Nueva cotizaci√≥n - Hotel Plaza Real</div>
                        <div class="activity-meta">Cotizaci√≥n #2024-0156 ‚Ä¢ Hace 4 horas</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon payment">üìÑ</div>
                    <div class="activity-content">
                        <div class="activity-title">Factura pagada - Colegio San Patricio</div>
                        <div class="activity-meta">$850,000 ‚Ä¢ Hace 1 d√≠a</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon service">üöø</div>
                    <div class="activity-content">
                        <div class="activity-title">Lavado de tanque - Cl√≠nica San Rafael</div>
                        <div class="activity-meta">Programado para ma√±ana ‚Ä¢ Mar√≠a Gonz√°lez</div>
                    </div>
                </div>

                <div class="activity-item">
                    <div class="activity-icon quote">üí∞</div>
                    <div class="activity-content">
                        <div class="activity-title">Cotizaci√≥n aprobada - Panader√≠a Central</div>
                        <div class="activity-meta">$520,000 mensuales ‚Ä¢ Hace 2 d√≠as</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions & Calendar -->
            <div>
                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Acciones R√°pidas</h2>
                    </div>

                    <div class="quick-actions">
                        <a href="cotizaciones.html" class="quick-action">
                            <div class="quick-action-icon">üí∞</div>
                            <div>
                                <div style="font-weight: 600;">Nueva Cotizaci√≥n</div>
                                <div style="font-size: 0.8em; color: #718096;">Crear propuesta comercial</div>
                            </div>
                        </a>

                        <a href="agenda.html" class="quick-action">
                            <div class="quick-action-icon">üìÖ</div>
                            <div>
                                <div style="font-weight: 600;">Programar Servicio</div>
                                <div style="font-size: 0.8em; color: #718096;">Agendar nueva visita</div>
                            </div>
                        </a>

                        <a href="facturas.html" class="quick-action">
                            <div class="quick-action-icon">üìÑ</div>
                            <div>
                                <div style="font-weight: 600;">Generar Factura</div>
                                <div style="font-size: 0.8em; color: #718096;">Facturar servicios</div>
                            </div>
                        </a>

                        <a href="inventario.html" class="quick-action">
                            <div class="quick-action-icon">üì¶</div>
                            <div>
                                <div style="font-weight: 600;">Revisar Inventario</div>
                                <div style="font-size: 0.8em; color: #718096;">Gestionar productos</div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Mini Calendar -->
                <div class="card calendar-widget">
                    <div class="card-header">
                        <h2 class="card-title">Calendario</h2>
                        <span style="color: #718096; font-size: 0.9em;">Enero 2025</span>
                    </div>

                    <div class="calendar-grid">
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">D</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">L</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">M</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">M</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">J</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">V</div>
                        <div style="text-align: center; font-weight: 600; color: #718096; padding: 0.5rem;">S</div>

                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day">1</div>
                        <div class="calendar-day has-service">2</div>
                        <div class="calendar-day">3</div>
                        <div class="calendar-day">4</div>
                        <div class="calendar-day">5</div>
                        <div class="calendar-day">6</div>
                        <div class="calendar-day">7</div>
                        <div class="calendar-day">8</div>
                        <div class="calendar-day">9</div>
                        <div class="calendar-day">10</div>
                        <div class="calendar-day has-service">11</div>
                        <div class="calendar-day">12</div>
                        <div class="calendar-day">13</div>
                        <div class="calendar-day">14</div>
                        <div class="calendar-day has-service">15</div>
                        <div class="calendar-day">16</div>
                        <div class="calendar-day">17</div>
                        <div class="calendar-day">18</div>
                        <div class="calendar-day">19</div>
                        <div class="calendar-day">20</div>
                        <div class="calendar-day">21</div>
                        <div class="calendar-day">22</div>
                        <div class="calendar-day">23</div>
                        <div class="calendar-day">24</div>
                        <div class="calendar-day">25</div>
                        <div class="calendar-day">26</div>
                        <div class="calendar-day">27</div>
                        <div class="calendar-day">28</div>
                        <div class="calendar-day">29</div>
                        <div class="calendar-day today">30</div>
                        <div class="calendar-day">31</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
// URL base de la API
const API_BASE_URL = 'https://backendgeminiambienta-v4-0.onrender.com/api';

// Funci√≥n para cargar datos del dashboard
async function loadDashboardData() {
    console.log("Iniciando carga de datos del dashboard...");
    
    // ‚úÖ 1. Obtener el token JWT del almacenamiento local
    const token = localStorage.getItem('jwtToken');
    if (!token) {
        alert('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
        window.location.href = 'index.html'; // Redirige a la p√°gina de login
        return;
    }

    // ‚úÖ 2. Configurar los encabezados con el token de autenticaci√≥n
    const headers = {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
    };

    try {
        // ‚úÖ 3. Usar los headers en cada solicitud fetch
        const [
            clientesRes,
            serviciosRes,
            facturasRes,
            productosRes
        ] = await Promise.all([
            fetch(`${API_BASE_URL}/personas?rol=Cliente`, { headers }).then(r => r.json()),
            fetch(`${API_BASE_URL}/servicios`, { headers }).then(r => r.json()),
            fetch(`${API_BASE_URL}/facturas`, { headers }).then(r => r.json()),
            fetch(`${API_BASE_URL}/productos`, { headers }).then(r => r.json())
        ]);

        const clientes = Array.isArray(clientesRes) ? clientesRes : [];
        const servicios = Array.isArray(serviciosRes) ? serviciosRes : [];
        const facturas = Array.isArray(facturasRes) ? facturasRes : [];
        const productos = Array.isArray(productosRes) ? productosRes : [];

        console.log("Datos recibidos - Clientes:", clientes.length, "Servicios:", servicios.length, "Facturas:", facturas.length, "Productos:", productos.length);

        // --- Actualizar Estad√≠sticas ---
        updateStatCard('primary', clientes.length); // Clientes Activos
        updateStatCard('warning', servicios.filter(s => s.estado === 'Programado' || s.estado === 'En_Progreso').length); // Servicios Pendientes

        // Calcular facturaci√≥n mensual
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        const facturacionMensual = facturas
            .filter(f => {
                const fechaFactura = new Date(f.fechaEmision);
                return fechaFactura.getMonth() === currentMonth && fechaFactura.getFullYear() === currentYear;
            })
            .reduce((sum, f) => sum + (f.montoTotal || 0), 0);

        updateStatCard('success', formatCurrency(facturacionMensual)); // Facturaci√≥n Mensual
        updateStatCard('info', productos.filter(p => p.stock > 0).length); // Productos en Stock

        // --- Actualizar Actividades Recientes ---
        renderRecentActivities(servicios, facturas);

    } catch (error) {
        console.error('Error al cargar datos del dashboard:', error);
        // Mostrar mensaje de error en la UI
        const statNumbers = document.querySelectorAll('.stat-number');
        statNumbers.forEach(el => el.textContent = 'Error');
        
        const activitiesContainer = document.querySelector('.card');
        if (activitiesContainer) {
            activitiesContainer.innerHTML = '<p style="color: #f56565; text-align: center;">Error al cargar actividades</p>';
        }
    }
}
    // Funci√≥n para actualizar una tarjeta de estad√≠stica
    function updateStatCard(cardClass, value) {
        // Seleccionamos la primera tarjeta que coincida con la clase. 
        // Esto puede ser fr√°gil si el orden cambia. Idealmente, usa IDs √∫nicos.
        const card = document.querySelector(`.stat-card.${cardClass}`);
        if (card) {
            const numberElement = card.querySelector('.stat-number');
            if (numberElement) {
                numberElement.textContent = value;
            }
        }
    }

    // Funci√≥n para formatear n√∫meros como moneda (simplificado)
    function formatCurrency(value) {
        // Asegurarse de que el valor sea un n√∫mero
        const numValue = typeof value === 'number' ? value : parseFloat(value) || 0;
        // Este es un ejemplo simple. Puedes usar Intl.NumberFormat para m√°s precisi√≥n y localizaci√≥n.
        return '$' + numValue.toLocaleString('es-CO', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }

    // Funci√≥n para renderizar actividades recientes (simulaci√≥n)
    function renderRecentActivities(servicios, facturas) {
        const activitiesContainer = document.querySelector('.card'); // Asumimos que el primer .card es el de actividades
        if (!activitiesContainer) {
            console.error("No se encontr√≥ el contenedor de actividades recientes.");
            return;
        }

        // Limpiar actividades existentes
        const existingItems = activitiesContainer.querySelectorAll('.activity-item');
        existingItems.forEach(item => item.remove());

        // Combinar y ordenar servicios y facturas por fecha (ejemplo simplificado)
        const actividades = [
            ...servicios.slice(0, 3).map(s => ({ type: 'service', data: s })), // Tomar 3 servicios m√°s recientes
            ...facturas.slice(0, 2).map(f => ({ type: 'invoice', data: f }))  // Tomar 2 facturas m√°s recientes
        ].sort((a, b) => {
            // Obtener fechas para ordenar (esto es una simplificaci√≥n, ajusta seg√∫n tus modelos)
            let dateA, dateB;
            if (a.type === 'service') {
                // Asumiendo que 'servicios' tiene una propiedad 'fecha'
                dateA = new Date(a.data.fecha + 'T' + (a.data.hora || '00:00')); 
            } else { // invoice
                 // Asumiendo que 'facturas' tiene una propiedad 'fechaEmision'
                dateA = new Date(a.data.fechaEmision); 
            }
            
            if (b.type === 'service') {
                dateB = new Date(b.data.fecha + 'T' + (b.data.hora || '00:00'));
            } else { // invoice
                dateB = new Date(b.data.fechaEmision);
            }
            
            return dateB - dateA; // Descendente
        }).slice(0, 5); // Tomar las 5 m√°s recientes


        if (actividades.length === 0) {
            activitiesContainer.innerHTML += '<div class="activity-item"><p style="color: #718096; text-align: center;">No hay actividades recientes.</p></div>';
            return;
        }

        actividades.forEach(({ type, data }) => {
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';

            let icon, title, meta;

            if (type === 'service') {
                icon = 'üîß';
                // Ajusta estos campos seg√∫n tu modelo de Servicio
                title = data.descripcion || 'Servicio sin descripci√≥n';
                // Asumiendo relaciones cargadas correctamente
                const clienteNombre = data.cotizacion?.cliente?.nombre || 'Cliente desconocido';
                const tecnicoNombre = data.empleadoAsignado?.nombre || 'T√©cnico no asignado';
                meta = `Cliente: ${clienteNombre} ‚Ä¢ T√©cnico: ${tecnicoNombre}`;
            } else if (type === 'invoice') {
                icon = 'üìÑ';
                // Ajusta estos campos seg√∫n tu modelo de Factura
                title = `Factura #${data.idFactura || 'N/A'}`;
                const clienteNombre = data.cliente?.nombre || 'Cliente desconocido';
                const monto = formatCurrency(data.montoTotal || 0);
                meta = `Cliente: ${clienteNombre} ‚Ä¢ Monto: ${monto}`;
            }

            activityItem.innerHTML = `
                <div class="activity-icon ${type}">${icon}</div>
                <div class="activity-content">
                    <div class="activity-title">${title}</div>
                    <div class="activity-meta">${meta}</div>
                </div>
            `;
            activitiesContainer.appendChild(activityItem);
        });
    }


    // Inicializaci√≥n: Carga los datos cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Dashboard cargado. Iniciando carga de datos desde la API...');
        loadDashboardData();
    });

</script>
</body>

</html>